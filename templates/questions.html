{% extends "base.html" %}

{% block title %}Questionnaire{% endblock %}

{% block content %}
<div class="questions-page">
    <div class="progress-bar">
        <div class="progress" id="progress-fill" style="width: 40%"></div>
    </div>
    
    <h2>Relationship Questionnaire</h2>
    <p class="instruction">Please answer honestly for accurate results. All responses are confidential.</p>
    
    <form method="POST" action="{{ url_for('submit_answers') }}" id="questionnaire-form">
        <input type="hidden" name="gender" value="{{ gender }}">
        <input type="hidden" name="status" value="{{ status }}">
        
        <div class="questions-container">
            {% for question in questions %}
            <div class="question-card" data-domain="{{ question.domain }}">
                <div class="question-header">
                    <span class="question-number">Question {{ loop.index }}</span>
                    <span class="domain-badge">{{ question.domain|replace('_', ' ')|title }}</span>
                </div>
                <h3 class="question-text">{{ question.text }}</h3>
                
                <div class="options">
                    {% for option in question.options %}
                    <label class="option-label">
                        <input type="radio" name="q_{{ question.id }}" value="{{ option.id }}" required>
                        <span class="option-text">{{ option.option_text }}</span>
                    </label>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn-primary" id="submit-btn">
                Generate Partner Link â†’
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
    (function() {
        const form = document.getElementById('questionnaire-form');
        const progressBar = document.getElementById('progress-fill');
        const totalQuestions = parseInt('{{ questions|length }}', 10);
        
        if (!form || !progressBar || isNaN(totalQuestions)) {
            console.error('Form elements not found or invalid question count');
            return;
        }
        
        form.addEventListener('change', function() {
            const answeredQuestions = document.querySelectorAll('input[type="radio"]:checked').length;
            const progress = 40 + (answeredQuestions / totalQuestions) * 40; // 40% to 80%
            progressBar.style.width = progress + '%';
        });
        
        // Smooth scroll to next unanswered question
        document.querySelectorAll('input[type="radio"]').forEach(function(radio) {
            radio.addEventListener('change', function() {
                const currentCard = this.closest('.question-card');
                const nextCard = currentCard ? currentCard.nextElementSibling : null;
                
                if (nextCard && nextCard.classList.contains('question-card')) {
                    setTimeout(function() {
                        nextCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 300);
                }
            });
        });
    })();
</script>
{% endblock %}